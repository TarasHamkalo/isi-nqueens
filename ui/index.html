<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N-Queens Problem</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<h1 style="text-align: center;">N-Queens Problem Visualizer</h1>
<div class="container">
    <div class="controls controls-left">
        <button id="solveButton">Solve</button>
        <button id="solveButton1">Solve</button>
        <button id="solveButton2">Solve</button>
    </div>

    <div id="board" class="board"></div>

    <div class="controls controls-right">
        <div class="one-step-button">
            <button id="backwardButton"><<</button>
            <button id="forwardButton">>></button>
        </div>
        <button id="runButton">Play</button>
        <form id="playbackSpeedForm" action="#" onsubmit="setPlaybackSpeed(event)">
            <label for="playbackSpeed">Playback speed:</label>
            <div style="display: inline-flex; align-items: center;">
                <input type="text" id="playbackSpeed" name="playbackSpeed" placeholder="1000">
                <span style="margin-left: 8px;">ms</span>
            </div>
        </form>

    </div>
</div>

<script>
    const N = 8;
    let actualStep = 0;
    let solutionSteps = [];
    let isRun = false;
    let stepInterval;
    let playbackSpeed = 1000;

    document.addEventListener("DOMContentLoaded", () => {
        const board = document.getElementById('board');
        board.style.gridTemplateColumns = `repeat(${N}, 1fr)`;
        initBoard(board);
        defineQueen();

        document.getElementById('solveButton').addEventListener('click', () => {
            setSolutionSteps();
        });

        document.getElementById('forwardButton').addEventListener('click', () => {
            stepForward();
        });

        document.getElementById('backwardButton').addEventListener('click', () => {
            stepBackward();
        });

        document.getElementById("playbackSpeed").addEventListener("wheel", (event) => {
            event.preventDefault();

            if (event.deltaY < 0) {
                playbackSpeed += 50;
            } else {
                playbackSpeed = Math.max(0, playbackSpeed - 50);
            }
            document.getElementById("playbackSpeed").value = playbackSpeed;
        });

        document.getElementById('runButton').addEventListener('click', () => {
            isRun = !isRun
            if (isRun) {
                document.querySelector('#runButton').innerText = 'Pause';
                stepInterval = setInterval(safeStepForward, playbackSpeed)
            } else {
                pausePlaying()
            }
        });
    });

    function setPlaybackSpeed(event) {
        event.preventDefault();
        playbackSpeed = document.getElementById("playbackSpeed").value
        document.getElementById("playbackSpeed").value = playbackSpeed;
    }

    function safeStepForward() {
        if (actualStep >= solutionSteps.length) {
            pausePlaying()
        }
        stepForward();
    }

    function pausePlaying() {
        isRun = false;
        clearInterval(stepInterval)
        document.querySelector('#runButton').innerText = 'Play';
    }

    function stepForward() {
        if (actualStep < solutionSteps.length) {
            queenToggle(solutionSteps[actualStep][0], solutionSteps[actualStep][1]);
            actualStep++;
        }
    }

    function stepBackward() {
        if (actualStep > 0) {
            actualStep--;
            queenToggle(solutionSteps[actualStep][0], solutionSteps[actualStep][1]);
        }
    }

    function setSolutionSteps() {
        solutionSteps = [[0, 0], [1, 2], [2, 4], [3, 1], [4, 3], [4, 3], [4, 7], [4, 7], [3, 1], [3, 6], [4, 1], [5, 3], [6, 5], [6, 5], [5, 3], [4, 1], [4, 3], [4, 3], [3, 6], [3, 7], [4, 1], [5, 3], [6, 5], [6, 5], [5, 3], [4, 1], [4, 3], [4, 3], [3, 7], [2, 4], [2, 5], [3, 1], [4, 6], [5, 4], [5, 4], [4, 6], [3, 1], [3, 7], [4, 1], [5, 3], [5, 3], [5, 4], [5, 4], [4, 1], [3, 7], [2, 5], [2, 6], [3, 1], [4, 3], [5, 7], [5, 7], [4, 3], [4, 7], [5, 4], [5, 4], [4, 7], [3, 1], [2, 6], [2, 7], [3, 1], [4, 3], [4, 3], [4, 6], [4, 6], [3, 1], [3, 5], [4, 1], [4, 1], [4, 3], [5, 1], [6, 4], [6, 4], [5, 1], [4, 3], [3, 5], [2, 7], [1, 2], [1, 3], [2, 1], [3, 4], [4, 2], [4, 2], [4, 7], [4, 7], [3, 4], [3, 6], [4, 2], [4, 2], [3, 6], [3, 7], [4, 2], [5, 6], [5, 6], [4, 2], [4, 5], [5, 2], [5, 2], [4, 5], [3, 7], [2, 1], [2, 5], [3, 2], [3, 2], [3, 7], [4, 1], [5, 4], [6, 2], [6, 2], [5, 4], [5, 6], [6, 2], [6, 2], [5, 6], [4, 1], [4, 2], [5, 4], [5, 4], [5, 6], [5, 6], [4, 2], [3, 7], [2, 5], [2, 6], [3, 2], [4, 5], [5, 1], [6, 4], [6, 4], [5, 1], [4, 5], [4, 7], [5, 1], [6, 4], [6, 4], [5, 1], [4, 7], [3, 2], [3, 4], [4, 1], [4, 1], [4, 2], [4, 2], [4, 7], [5, 1], [5, 1], [4, 7], [3, 4], [2, 6], [2, 7], [3, 2], [3, 2], [3, 4], [4, 1], [4, 1], [4, 2], [4, 2], [3, 4], [2, 7], [1, 3], [1, 4], [2, 1], [3, 5], [4, 2], [5, 6], [6, 3], [6, 3], [5, 6], [4, 2], [3, 5], [3, 7], [4, 2], [5, 6], [6, 3], [6, 3], [5, 6], [4, 2], [4, 5], [5, 2], [5, 2], [5, 3], [5, 3], [4, 5], [3, 7], [2, 1], [2, 6], [3, 1], [4, 3], [5, 7], [5, 7], [4, 3], [4, 5], [5, 2], [5, 2], [5, 7], [5, 7], [4, 5], [3, 1], [2, 6], [2, 7], [3, 1], [4, 3], [5, 6], [6, 2], [6, 2], [5, 6], [4, 3], [4, 6], [5, 2], [6, 5], [6, 5], [5, 2], [4, 6], [3, 1], [3, 5], [4, 2], [5, 6], [6, 1], [7, 3]];
    }

    function defineQueen() {
        const queen_img = document.createElement("img");
        queen_img.src = 'fig/queen.png';
        queen_img.classList.add('queen');
        queen_img.style.mixBlendMode = 'multiply';
        return queen_img;
    }

    function initBoard(board) {
        for (let i = 0; i < N * N; i++) {
            const cell = document.createElement('div');
            cell.classList.add('cell', (Math.floor(i / N) + i) % 2 === 0 ? 'white' : 'black');
            board.appendChild(cell);
        }
    }

    function queenToggle(row, col) {
        const boardCells = document.querySelectorAll('.cell');
        const queenIndex = row * N + col;
        console.log(queenIndex)
        if (boardCells[queenIndex].firstChild) {
            boardCells[queenIndex].removeChild(boardCells[queenIndex].firstChild);
        } else {
            boardCells[queenIndex].appendChild(defineQueen());
        }
    }
</script>

</body>
</html>